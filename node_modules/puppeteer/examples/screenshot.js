/**
 * Copyright 2017 Google Inc. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

'use strict';
//延时函数
function sleep(delay) {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      try {
        resolve(1)
      } catch (e) {
        reject(0)
      }
    }, delay)
  })
}
var log4js = require('log4js');
// 注：配置里的日志目录要先创建，才能加载配置，不然会出异常
log4js.configure("./configure/log4js.json");
/*var logInfo = log4js.getLogger('logInfo');*/
/*logInfo.info("测试日志信息");*/

const puppeteer = require('puppeteer');
(async() => {

    const browser= await puppeteer.launch({
      executablePath: './chromium/chrome.exe',
      ignoreHTTPSErrors:true,
      slowMo:250,
      timeout:0,
      headless:false
    });

    let page = await browser.newPage();
    page.on("error",err =>{
      logger.error("qx-error:"+err.message);
    });
    page.on("requestfailed",request =>{
      logger.error("qx-request:"+"this url("+parameters.url+"):"+request.failure().errorText);
    });
    await page.setJavaScriptEnabled(true);
    await page.setViewport({width:1920, height:600});
    await page.goto('https://www.underarmour.cn/',{timeout:0});
    let scrollEnable = true;
    let scrollStep = 500; //每次滚动的步长
    while (scrollEnable) {
      scrollEnable = await page.evaluate((scrollStep) => {
        let scrollTop = document.scrollingElement.scrollTop;
        document.scrollingElement.scrollTop = scrollTop + scrollStep;
        return document.body.clientHeight > document.scrollingElement.scrollTop+document.documentElement.clientHeight ? true : false;
      }, scrollStep);
      /*await sleep(100);*/
    }
    await page.screenshot({path: './img/excep2.png',fullPage:true});
  await page.close();
  await browser.close();
})();


